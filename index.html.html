<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<link rel="icon" href="https://i.pinimg.com/1200x/0c/84/03/0c8403c67ff395372ded8dafe83b75de.jpg" type="image/png">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>The Cipher WitchCrypt</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=IM+Fell+English&display=swap" rel="stylesheet">

<style>
:root{
  --accent-1:#caa76b;
  --accent-2:#8b5a2b;
  --accent-3:#5e7a1f;
  --paper:#f3e8c0;
  --txt-dark:#2f2418;
  --spell-dark:#3a2c1a;
  --glow:0 0 14px rgba(255,238,180,.75);
}

*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:"IM Fell English",serif}
body{
  display:flex;justify-content:center;align-items:center;
  background:url('https://i.pinimg.com/736x/db/36/a6/db36a6b95b3a390a72964def078afaf7.jpg') center/cover fixed;
  color:var(--paper);overflow:hidden;
}
body.night{filter:brightness(.45) saturate(1.2)}

#particle-canvas{position:fixed;inset:0;pointer-events:none;z-index:10}

.app{
  width:95%;
  max-width:820px;
  max-height:90vh;
  overflow-y:auto;
  padding:22px;
  border-radius:14px;
  background:linear-gradient(180deg,rgba(20,16,12,.85),rgba(12,10,8,.88));
  box-shadow:0 20px 60px rgba(0,0,0,.7);
  animation:openScroll .7s cubic-bezier(.19,1,.22,1);
  scrollbar-width: thin;
  scrollbar-color: #caa76b transparent;
}
.app::-webkit-scrollbar{width:8px;}
.app::-webkit-scrollbar-thumb{
  background:#caa76b;
  border-radius:6px;
}

.panel{
  background:linear-gradient(180deg,rgba(243,232,192,.98),rgba(240,228,176,.98));
  padding:20px;border-radius:10px;color:var(--txt-dark);
}

.header{text-align:center;position:sticky;top:0;z-index:100;padding:10px 0;}
.title{
  font-family:"Cinzel",serif;font-size:34px;color:#6a4324;
  text-shadow:0 0 10px rgba(245,220,140,.75);
}
.runes{font-size:20px;margin-top:6px;animation:runePulse 2s infinite alternate}

label{display:block;font-weight:700;margin:12px 0 6px}
textarea{
  width:100%;padding:12px;border-radius:10px;
  border:2px solid #d7c396;background:var(--paper);
  font-size:15px;resize:vertical;
}
#output{min-height:110px}

.controls,.small-row{display:flex;gap:14px;margin-top:12px}
.btn{
  flex:1;padding:12px;border-radius:10px;border:none;
  font-family:"Cinzel",serif;color:#fff;cursor:pointer;
}
.encrypt{background:var(--accent-2);box-shadow:var(--glow)}
.decrypt{background:var(--accent-3);box-shadow:var(--glow)}

.key-select{display:flex;gap:14px;margin-top:6px}
.key-option{
  flex:1;padding:12px;border-radius:12px;text-align:center;
  font-family:"Cinzel",serif;cursor:pointer;
  background:linear-gradient(180deg,#f2e4bc,#e6d39a);
  border:2px solid #b89b5e;color:#3a2c1a;transition:.25s;position:relative;
}
.key-option input{display:none}
.key-option span{display:block;font-size:20px}
.key-option small{display:block;font-size:12px;opacity:.8}
.key-option:hover{box-shadow:0 0 12px rgba(202,167,107,.8);}
.key-option input:checked + div{
  background:linear-gradient(180deg,#d4b56d,#b89048);
  box-shadow:0 0 18px rgba(255,230,160,.9);
}

.modal{
  position:fixed;inset:0;background:rgba(0,0,0,.6);
  display:none;align-items:center;justify-content:center;
}
.card{
  background:linear-gradient(180deg,#fef8e6,#f6e9c2);
  padding:24px;border-radius:12px;max-width:740px;
  color:var(--spell-dark);
}
.card h2{font-family:"Cinzel",serif;margin-top:0}
.card ul{padding-left:20px}
.card li{margin-bottom:8px;line-height:1.5}

@keyframes openScroll{
  from{transform:scaleY(.85) translateY(-20px);opacity:0}
  to{transform:scaleY(1) translateY(0);opacity:1}
}
@keyframes runePulse{
  from{text-shadow:0 0 6px rgba(255,240,190,.5)}
  to{text-shadow:0 0 18px rgba(255,240,190,1)}
}
@media(max-width:560px){
  .controls,.small-row,.key-select{flex-direction:column}
  .title{font-size:26px}
}
</style>
</head>

<body>
<canvas id="particle-canvas"></canvas>

<main class="app">
<div class="panel">

<header class="header">
<h1 class="title">ü™Ñ The Cipher WitchCrypt</h1>
</header>

<label>Write Your Spell</label>
<textarea id="input"></textarea>

<label>Choose Cipher Key</label>
<div class="key-select">
<label class="key-option">
<input type="radio" name="keyMode" value="system" checked>
<div><span>·ö±</span>System Key<small>Ancient & Stable</small></div>
</label>
<label class="key-option">
<input type="radio" name="keyMode" value="custom">
<div><span>·ö®</span>Custom Key<small>Your Own Matrix</small></div>
</label>
</div>

<div id="customKey" style="display:none">
<label>Custom Hill Cipher Key (3√ó3)</label>
<textarea id="keyInput" placeholder="6 24 1
13 16 10
20 17 15"></textarea>
</div>

<div class="controls">
<button class="btn encrypt" onclick="encrypt()">Cast Encrypt Spell</button>
<button class="btn decrypt" onclick="decrypt()">Reveal Hidden Spell</button>
</div>

<label>Revealed Spell</label>
<textarea id="output" readonly></textarea>

<div class="small-row">
<button class="btn encrypt" onclick="openBook()">üìú Spellbook</button>
<button class="btn decrypt" onclick="toggleNight()">üïØÔ∏è Night Ritual</button>
<button class="btn encrypt" onclick="clearAll()">‚ùå Cancel Spell</button>
</div>

</div>
</main>

<div class="modal" id="modal">
<div class="card">
<h2>üìú Hill Cipher ‚Äî Arcane Mechanics (3√ó3)</h2>
<p>The Hill Cipher is a <b>polygraphic substitution cipher</b> that encrypts multiple letters at once using linear algebra.</p>
<ul>
<li>Each letter is converted to a number: <b>A = 0 ‚Ä¶ Z = 25</b></li>
<li>Plaintext is grouped into vectors of <b>3 letters</b></li>
<li>Encryption formula: <b>C = K √ó P (mod 26)</b></li>
<li>The key <b>K</b> is a 3√ó3 matrix known only to the caster</li>
<li>The determinant of <b>K</b> must be coprime with 26 to allow decryption</li>
<li>Decryption uses the <b>inverse matrix K‚Åª¬π (mod 26)</b></li>
<li>Padding uses the letter <b>X</b> to complete vectors</li>
<li>If the matrix is not invertible, the spell is irreversible</li>
<li>Tip: Always test your custom matrix before casting</li>
<li>Advanced: You can combine multiple Hill ciphers for extra arcane power</li>
</ul>
<button class="btn encrypt" onclick="closeBook()">Close Grimoire</button>
</div>
</div>

<script>
/* ===== SYSTEM KEY ===== */
const SYSTEM_K=[[6,24,1],[13,16,10],[20,17,15]];
const SYSTEM_INV=[[8,5,10],[21,8,21],[21,12,8]];

/* ===== UTILS ===== */
const A=c=>c.charCodeAt(0)-65;
const C=n=>String.fromCharCode((n%26+26)%26+65);

function clean(t){
  t=t.toUpperCase().replace(/[^A-Z]/g,'');
  while(t.length%3!==0) t+='X';
  return t;
}

function hill(text,m){
  let r='';
  for(let i=0;i<text.length;i+=3){
    let v=[A(text[i]),A(text[i+1]),A(text[i+2])];
    for(let x=0;x<3;x++){
      r+=C(m[x][0]*v[0]+m[x][1]*v[1]+m[x][2]*v[2]);
    }
  }
  return r;
}

function gcd(a,b){return b?gcd(b,a%b):Math.abs(a)}
function det3(m){return (m[0][0]*(m[1][1]*m[2][2]-m[1][2]*m[2][1])
       -m[0][1]*(m[1][0]*m[2][2]-m[1][2]*m[2][0])
       +m[0][2]*(m[1][0]*m[2][1]-m[1][1]*m[2][0]))%26;}

function getKey(){
 if(document.querySelector('input[name="keyMode"]:checked').value==='system')
  return {K:SYSTEM_K,Kinv:SYSTEM_INV};

 let rows=keyInput.value.trim().split('\n').map(r=>r.trim().split(/\s+/).map(Number));
 if(rows.length!==3||rows.some(r=>r.length!==3||r.some(isNaN)))
  throw 'Invalid 3√ó3 matrix';

 let d=((det3(rows)%26)+26)%26;
 if(gcd(d,26)!==1) throw 'Matrix not invertible mod 26';
 return {K:rows,Kinv:null};
}

/* ===== ACTIONS ===== */
function encrypt(){
  try{output.value=hill(clean(input.value),getKey().K);}catch(e){alert('‚ö†Ô∏è '+e);}
}

function decrypt(){
  try{
    let k=getKey();
    if(!k.Kinv) throw 'Custom key needs inverse';
    let txt = hill(clean(input.value),k.Kinv);
    // remove padding X automatically
    output.value = txt.replace(/X+$/,'');
  }catch(e){alert('‚ö†Ô∏è '+e);}
}

function clearAll(){input.value='';output.value=''}
function toggleNight(){document.body.classList.toggle('night')}
function openBook(){modal.style.display='flex'}
function closeBook(){modal.style.display='none'}

document.querySelectorAll('input[name="keyMode"]').forEach(r=>{
 r.addEventListener('change',()=>customKey.style.display=
   r.value==='custom'&&r.checked?'block':'none');
});

/* ===== PARTICLES ===== */
(()=>{const c=document.getElementById('particle-canvas'),x=c.getContext('2d');function r(){c.width=innerWidth;c.height=innerHeight}addEventListener('resize',r);r();const p=[...Array(120)].map(()=>
 ({x:Math.random()*c.width,y:Math.random()*c.height,r:Math.random()*2+1,dx:(Math.random()-.5)*.4,dy:(Math.random()-.5)*.4}));
 (function d(){x.clearRect(0,0,c.width,c.height);for(let o of p){x.beginPath();x.arc(o.x,o.y,o.r,0,Math.PI*2);x.fillStyle='rgba(255,230,160,.6)';x.fill();o.x+=o.dx;o.y+=o.dy;if(o.y<0)o.y=c.height;if(o.x<0)o.x=c.width;if(o.x>c.width)o.x=0;}requestAnimationFrame(d);})();})();
</script>
</body>
</html>
